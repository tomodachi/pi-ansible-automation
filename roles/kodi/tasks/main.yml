---
  - name: Install packages
    apt:
      name: [ kodi, mesa-utils, ca-certificates, samba-common-bin,  cec-utils, pulseaudio ]
      state: latest
      update_cache: yes

  - name: Add kodi user
    user: 
      name: kodi 
      createhome: yes 
      shell: /bin/false
      password: no 
      system: yes
      groups: video,input,pulse-access

  - name: Create Kodi service
    copy:
      src: ./files/kodi.service 
      dest: /etc/systemd/system/kodi.service
      owner: kodi
      group: kodi
      mode: '0600'

  - name: Start Kodi on boot
    service: name=kodi state=started enabled=yes

  - name: Create kodi settings folders
    file:
      path: /home/kodi/.kodi/userdata
      state: directory
      owner: kodi
      group: kodi

  - name: setup kodi media sources
    copy: 
      src: ./files/sources.xml.myown 
      dest: /home/kodi/.kodi/userdata/sources.xml
      owner: kodi 
      group: kodi
      mode: '0644'
    tags: sources
   
  - name: tweak gpu_mem for video to work
    lineinfile:
      path: /boot/config.txt
      line: "gpu_mem=256" 
      create: yes
